% !TEX root = ../paper.tex
\documentclass{standalone}
\input{macros}
\begin{document}


\flushleft

\fbox{$\Rvalid \llbracket \V{ts} \rrbracket_{(\tau l, \V{inst})} : \V{Val} \rightarrow \iProp $}
\[
\begin{array}{rcl}
%
  \Rvalid \llbracket \V{ts} \rrbracket_{(\tau l, \V{inst})}(w) & \triangleq & \exists \V{lh}, v,  w = \V{lh}[\textbf{return}] \ast \V{lh}(0) = v \ast {}
\\
  & & \exists \tau s', \Vvalid\llbracket \tau s' \rrbracket(v) \ast {}
\\
  & & \forall F, F', \rr{allocator}, \frameR{} F' \rr{\ast{} \Avalid(\V{allocator})} \wand
\\
  & & \wprefr{w}{n}{F}{\begin{aligned} \V{w}, &\Vvalid \llbracket \V{ts} \rrbracket(w) \ast{} \frameR{} F' \\ & \rr{\ast{} \exists\V{allocator'}, \Avalid(\V{allocator'})} \end{aligned} }
%
\end{array}
\]



\fbox{$\CONTvalid \llbracket \tau s \rrbracket_{(\tau l, \V{inst}, \V{hfs})}^{\tau_{\K{lbs}}, \tau_{\K{ret}}} : \V{Lholed} \times \mathds{N} \rightarrow \iProp $}
\[
\begin{array}{rcl}
 %
  \CONTvalid \llbracket \tau s \rrbracket_{(\tau l, \V{inst}, \V{hfs})}^{\tau_{\K{lbs}}, \tau_{\K{ret}}}(\V{lh}_n,j) & \triangleq &
  \begin{array}[t]{l}
    \exists \V{vs}, k, \V{es}, \V{lh}'_m, \V{es'}, \V{lh}''_{n - S(j)},
  \\
    \quad
    \begin{array}{l}
      \V{lh}_n(n - S(j)) = (\V{vs},k,\V{es},\V{lh}',\V{es}') \ast {}
    \\
      \K{outer}_{n - S(j)}(\V{lh}_n) = \V{lh}_{n - S(j)} \ast {}
    \\
    \always \forall v, F, \rr{\V{allocator}}, \Vvalid \llbracket \tau s \rrbracket(v) \wand
                                                                                                          \\
                                                                                                          \qquad{} \FRvalid \llbracket \tau l \rrbracket_{\V{inst}}(F) \wand \rr{\Avalid(\V{allocator}) \wand}
                                                                                                          \\
                                                                                                          \qquad\qquad{} \exists \tau s_2, \Evalid \llbracket \tau s_2 \rrbracket_{\tau l, \V{inst}, \V{hfs})}^{\K{drop}~S(j)~\tau_{\K{lbs}},\tau_{\K{ret}}}{ \left(\V{lh}''_{n - S(j)}, \V{vs}\mdoubleplus v \mdoubleplus \V{es} \mdoubleplus \V{es}' \right) }\\[1em]
      \end{array}
    \end{array}
  \end{array}
\]



\end{document}
