% !TEX root = ../paper.tex
\documentclass{standalone}
\input{macros}
\begin{document}
\footnotesize



\[ \inferrule[\texttt{wp\_get\_local}]{F.\xxfield{locs}[i] = \V{v} \ast{} \later \Phi(\immV{[v']}) \ast{} \frameR{F}}{\wpre{(\xxWlocalget~i)}{w, \Phi(w) \ast{} \frameR{F}}} \]



\[ \inferrule[\texttt{wp\_set\_local}]{i < \left|F.\xxfield{locs}\right|\ast{} \later \Phi(\immV{[]}) \ast{} \frameR{F}}{\wpre{(\V{v}; \xxWlocalset~i)}{w, \Phi(w) \ast{} \frameR{\{ \xxfield{inst} := F.\xxfield{inst}; \xxfield{locs} := \left<[i := \V{v}]\right>F.\xxfield{locs}}\}}} \]



\[ \inferrule[\texttt{wp\_tee\_local}]{\later (\frameR{F} \wand \wpre{(\V{v}; \V{v}; \xxWlocalset~i)}{w, \Phi(w)}) \ast{} \frameR{F}}{\wpre{(\V{v}; \xxWlocaltee~i)}{w, \Phi(w)}} \]


\[ \inferrule[\texttt{wp\_get\_global}]{F.\xxfield{inst}.\xxfield{globs}[i] = \V{n} \ast{} \V{n}~\wgpt~\{\V{mutability},\V{v}\} \ast{} \later \Phi(\immV{[v]}) \ast{} \frameR{F}}{\wpre{(\xxWglobalget~i)}{w, \Phi(w) \ast{} \V{n}~\wgpt~\V{g} \ast{} \frameR{F}}} \]


\[ \inferrule[\texttt{wp\_set\_global}]{F.\xxfield{inst}.\xxfield{globs}[i] = \V{n} \ast{} \V{n}~\wgpt~\{\KK{mut},-\} \ast{} \later \Phi(\immV{[]}) \ast{} \frameR{F}}{\wpre{(\V{v}; \xxWglobalset~i)}{w, \Phi(w) \ast{} \V{n}~\wgpt~\{\KK{mut},\V{v}\} \ast{} \frameR{F}}} \]


\[ \inferrule[\texttt{wp\_load}]{F.\xxfield{inst}.\xxfield{mems}[0] = \V{n} \ast{} \V{n}~\wmspt{(\V{i+off})}~\V{bs} \ast{}\\
 \textsf{deserialise}(\V{bs}) = \V{v} \ast{} \xxTypeof{v} = \V{t} \ast{} \later \Phi(\immV{[\V{v}]}) \ast{} \frameR{F}}{\wpre{(\xxWeconstt{\xxWithirtytwo}{i}; \xxWload~\V{t}~\V{off})}{w, \Phi(w) \ast{} \V{n}~\wmspt{(\V{i+off})}~\V{bs} \ast{} \frameR{F}}} \]
 

\[ \inferrule[\texttt{wp\_store}]{F.\xxfield{inst}.\xxfield{mems}[0] = \V{n} \ast{} \V{n}~\wmspt{(\V{i+off})}~\V{bs} \ast{} \\
\xxTypeof{v} = \V{t} \ast{} |\V{bs}| = |\V{t}| \ast{} \textsf{serialise}(\V{v}) =\V{bv} \ast{} \later \Phi(\immV{[]}) \ast{} \frameR{F}}{\wpre{(\xxWeconstt{\xxWithirtytwo}{i}; \V{v}; \xxWstore~\V{t}~\V{off})}{w, \Phi(w) \ast{} \V{n}~\wmspt{(\V{i+off})}~\V{bv} \ast{} \frameR{F}}} \]


\[ \inferrule[\texttt{wp\_current\_memory}]{F.\xxfield{inst}.\xxfield{mems}[0] = \V{n} \ast{} \V{n}~\wmlenpt~\V{len} \ast{} \lfloor \V{len}/{\pagesize}\rfloor = \V{c} \ast{} \later \Phi(\immV{[\xxWeconstt{\xxWithirtytwo}{\V{c}}]}) \ast{} \frameR{F}}{\wpre{\xxWcurrentmemory}{w, \Phi(w) \ast{} \V{n}~\wmlenpt~\V{len} \ast{} \frameR{F}}} \]


\[ \inferrule[\texttt{wp\_grow\_memory}]{F.\xxfield{inst}.\xxfield{mems}[0] = \V{n} \ast{} \V{n}~\wmlenpt~\V{len} \ast{} \lfloor \V{len}/{\pagesize}\rfloor = \V{c} \ast{}\\
\later \Phi(\immV{[\xxWeconstt{\xxWithirtytwo}{\V{c}}]}) \ast{}
\later \Psi(\immV{[\xxWeconstt{\xxWithirtytwo}{\V{(-1)}}]}) \ast{} \frameR{F}}{\wpre{(\xxWeconstt{\xxWithirtytwo}{c}; \xxWgrowmemory)}{w, 
\begin{array}{c}
\Big((\Phi(w) \ast{} \V{n}~\wmlenpt~(\V{len}+\V{c}\cdot{\pagesize}) \ast{} \V{n}~\wmspt{\V{len}}~(\mathsf{0x00})^{\pagesize}) \vee \\
(\Psi(w) \ast{} \V{n}~\wmlenpt~\V{len})\Big) \ast{}
 \frameR{F}
\end{array}
}} \]


\end{document}
