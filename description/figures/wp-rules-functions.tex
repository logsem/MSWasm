 %!TEX root = ../paper.tex
\documentclass{standalone}
\input{macros}
\begin{document}
\footnotesize


\[ \inferrule[\tt wp\_call]{
(F.\xxfield{inst}.\xxfield{funcs}[i] = \V{addri}) \ast{} \frameR F \ast{}\later\left(\frameR F\wand\wpre{[\xxWinvoke~\V{addri}]}{w,\Phi(w)}\right)
}{
\wpre{[\xxWcall~i]}{w,\Phi(w)}
}\]

\[ \inferrule[\texttt{wp\_call\_indirect\_success}]{
  \frameR F \ast{} (F.\xxfield{inst}.\xxfield{tabs}[0] = \V{ta}) \ast{} 
  \\\\
  (\V{ta}\wtpt{k}{\V{a}}) \ast{}
  (\V{a}\wfpt\V{cl}) \ast{}
	(F.\xxfield{inst}.\xxfield{types}[i]=\mathsf{typeof}~\V{cl})\ast{}
\\
  \later\left((\V{ta}\wtpt{k}{\V{a}})\wand(\V{ta}\wfpt\V{cl})\wand(\frameR F)\wand\wpre{[\xxWinvoke~\V{a}] }{w, \Phi(w)}\right)
}{
  \wpre{[\xxWeconstt{\xxWithirtytwo}{k}; \xxWcallindirect~i]}{w, \Phi(w) }
} \]


\[ \inferrule[\tt wp\_invoke\_native]{|\V{vs}| = |\V{ts_1}| \ast{} \V{cl} = \NCl{(\V{ts_1} \to \V{ts_2})}{(\V{inst};\V{ts})}{\V{es}} \ast{} F' = \{\xxfield{locs} := \V{vs} \cat \nzeros{ts}; \xxfield{inst} := \V{inst}\} \ast{}\\
 \V{i}~\wfpt~\V{cl} \ast{} \frameR{F} \ast{}
\later \left[\begin{array}{c}
(\V{i}~\wfpt~\V{cl}\ast{}\frameR{F}) \wand \arrcr
\wpre{\left(\xxWlocal{|\V{ts_2}|}{F'}{\left(\xxWblock~([]\to\V{ts_2})~\V{es}\right)}\right)}{w, \Phi(w)}
\end{array}\right]}
{\wpre{(\V{vs} \cat \xxWinvoke~\V{i})}{w, \Phi(w)}} \]


%\inferrule[\tt wp\_invoke\_host]{
%  \left( i \wfpt \HCl{\V{ts_1}\to\V{ts_2}}{\V{hidx}} \right)  \ast{}\frameR F \ast{} (|ts_1| = |vs|)\ast{}
%  \\
%  \later\left(\left(\left(i\wfpt \HCl{\V{ts_1}\to\V{ts_2}}{\V{hidx}}\right)\ast{}\frameR F\right)\wand\wpre{[\xxWcallhost~(\V{ts_1}\to\V{ts_2})~\V{hidx}~\V{vs}]}{w,\Phi(w)}\right)
%}{
%  \wpre{vs\cat[\xxWinvoke~i]}{w,\Phi(w)} 
%}

%\inferrule[\tt wp\_invoke\_native]{|\V{vs}| = |\V{ts_1}| \ast{} \V{cl} = \NCl{(\V{ts_1} \to \V{ts_2})}{(\V{inst};\V{ts})}{\V{es}} \ast{} F' = \{\xxfield{locs} := \V{vs} \cat \nzeros{ts}; \xxfield{inst} := \V{inst}\} \ast{}\\
% \V{i}~\wfpt~\V{cl} \ast{} \frameR{F} \ast{}
%\later \left[\begin{array}{c}
%(\frameR{F} \ast{} (\V{i}~\wfpt~\V{cl})) \wand \arrcr
%\wpre{\left(\xxWlocal{|\V{ts_2}|}{F'}{\left(\xxWblock~([]\to\V{ts_2})~\V{es}\right)}\right)}{w, \Phi(w)}
%\end{array}\right]}
%{\wpre{(\V{vs} \cat \xxWinvoke~\V{i})}{w, \Phi(w)}}
% 
%\vspace{0.1cm}

\[ \inferrule[\texttt{wp\_invoke\_host}]{|\V{vs}| = |\V{ts_1}| \ast{} \V{cl} = \HCl{(\V{ts_1} \to \V{ts_2})}{\V{hidx}} \ast{} \phantom{F' = \{\xxfield{locs} := \V{vs} \cat \nzeros{ts};\} } \\
 \V{i}~\wfpt~\V{cl} \ast{} \frameR{F} \ast{} \later \left[\begin{array}{c}
(\V{i}~\wfpt~\V{cl} \ast{} \frameR{F} ) \wand \arrcr
\wpre{(\xxWcallhost~(\V{ts_1} \to \V{ts_2})~\V{hidx}~\V{vs} )}{w, \Phi(w)}
\end{array}\right]}
{\wpre{(\V{vs} \cat [\xxWinvoke~\V{i}])}{w, \Phi(w)}} \]


%\inferrule[\texttt{wp\_call\_ctx}]{F.\xxfield{inst}.\xxfield{funcs}[i] = a \ast{} \frameR{F} \ast{} \later \left[
%\frameR{F} \wand \wprectx{(\xxWinvoke~\V{a})}{\V{d}}{\V{lh}}{w, \Phi(w)}
%\right]}
%{\wprectx{\xxWcall~\V{i}}{\V{d}}{\V{lh}}{w, \Phi(w)}}
%
%\vspace{0.1cm}
%
%\inferrule[\texttt{wp\_call\_indirect\_ctx}]{F.\xxfield{inst}.\xxfield{types}[i] = \V{ft} \ast{} F.\xxfield{inst}.\xxfield{tabs}[0] = \V{j} \ast{} \V{j}~\wtpt{\V{c}} \V{a} \ast{} \V{a}~\wfpt~\V{cl} \ast{} \frameR{F} \ast{} \\\later \left[
%(\frameR{F} \ast{} \V{j}~\wtpt{\V{c}} \V{a} \ast{} \V{a}~\wfpt~\V{cl}) \wand \wprectx{(\xxWinvoke~\V{a})}{\V{d}}{\V{lh}}{w, \Phi(w)}
%\right]}
%{\wprectx{(\xxWeconstt{\xxWithirtytwo}{c}; \xxWcallindirect~\V{i})}{\V{d}}{\V{lh}}{w, \Phi(w)}}

\end{document}
